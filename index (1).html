<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Formulario.ia â€” Documentos legales con IA</title>
  <meta name="description" content="GenerÃ¡ contratos, cartas y documentos legales en minutos con inteligencia artificial. Gratis para particulares." />
  <meta property="og:title" content="Formulario.ia â€” Documentos legales gratis con IA" />
  <meta property="og:description" content="GenerÃ¡ contratos, cartas y documentos en minutos. Sin registro. Gratis." />
  <meta name="theme-color" content="#2D6A4F" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;1,9..40,300&display=swap" rel="stylesheet" />

  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    /* â”€â”€â”€ TOKENS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    :root {
      --bg:           #F4F5F0;
      --bg-card:      #FFFFFF;
      --bg-input:     #FFFFFF;
      --surface:      #ECEEE8;
      --border:       #DDE0D8;
      --border-strong:#BEC3B8;

      --ink:          #1A1D17;
      --ink-2:        #3D4238;
      --ink-3:        #6B7066;
      --ink-muted:    #9BA39A;

      --accent:       #2D6A4F;
      --accent-light: #52B788;
      --accent-bg:    #D8F3DC;
      --accent-hover: #245B42;

      --indigo:       #3D5A99;
      --indigo-bg:    #EBF0FA;

      --warn-bg:      #FFF8E6;
      --warn-border:  #F0C040;
      --warn-ink:     #7A5C00;

      --radius-sm:    6px;
      --radius:       12px;
      --radius-lg:    18px;
      --radius-xl:    24px;

      --shadow-sm:    0 1px 3px rgba(0,0,0,.06), 0 1px 2px rgba(0,0,0,.04);
      --shadow:       0 4px 16px rgba(0,0,0,.08), 0 1px 4px rgba(0,0,0,.04);
      --shadow-lg:    0 12px 40px rgba(0,0,0,.10), 0 2px 8px rgba(0,0,0,.05);

      --font-display: 'DM Serif Display', Georgia, serif;
      --font-body:    'DM Sans', system-ui, sans-serif;

      --ease-out:     cubic-bezier(0.16, 1, 0.3, 1);
    }

    /* â”€â”€â”€ RESET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { font-size: 16px; -webkit-text-size-adjust: 100%; }
    body {
      font-family: var(--font-body);
      background: var(--bg);
      color: var(--ink);
      min-height: 100dvh;
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }
    button { cursor: pointer; border: none; background: none; font: inherit; }
    input, textarea { font: inherit; }
    a { color: inherit; text-decoration: none; }

    /* â”€â”€â”€ LAYOUT SHELL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .app-shell {
      display: flex;
      flex-direction: column;
      min-height: 100dvh;
    }

    /* â”€â”€â”€ VIEWS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .view { display: none; flex-direction: column; flex: 1; }
    .view.active { display: flex; }

    /* â”€â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .header {
      padding: 16px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--bg);
      position: sticky;
      top: 0;
      z-index: 10;
      border-bottom: 1px solid transparent;
      transition: border-color .2s;
    }
    .header.scrolled { border-color: var(--border); }

    .logo {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .logo-mark {
      width: 32px;
      height: 32px;
      background: var(--accent);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .logo-mark svg { width: 18px; height: 18px; }
    .logo-name {
      font-family: var(--font-display);
      font-size: 1.2rem;
      color: var(--ink);
      letter-spacing: -.01em;
    }
    .logo-name span { color: var(--accent); }

    .badge-free {
      font-size: .7rem;
      font-weight: 600;
      letter-spacing: .04em;
      text-transform: uppercase;
      color: var(--accent);
      background: var(--accent-bg);
      padding: 3px 8px;
      border-radius: 20px;
    }

    /* â”€â”€â”€ HOME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .home-hero {
      padding: 28px 20px 20px;
      text-align: center;
    }
    .home-hero h1 {
      font-family: var(--font-display);
      font-size: clamp(1.7rem, 5vw, 2.4rem);
      line-height: 1.15;
      color: var(--ink);
      margin-bottom: 10px;
      letter-spacing: -.02em;
    }
    .home-hero h1 em {
      font-style: italic;
      color: var(--accent);
    }
    .home-hero p {
      font-size: .9rem;
      color: var(--ink-3);
      max-width: 320px;
      margin: 0 auto;
      line-height: 1.55;
    }

    .section-label {
      padding: 0 20px;
      margin-bottom: 12px;
      font-size: .72rem;
      font-weight: 600;
      letter-spacing: .08em;
      text-transform: uppercase;
      color: var(--ink-muted);
    }

    /* â”€â”€â”€ DOCUMENT GRID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .doc-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      padding: 0 16px 20px;
    }
    @media (min-width: 480px) { .doc-grid { grid-template-columns: 1fr 1fr 1fr; } }
    @media (min-width: 768px) { .doc-grid { grid-template-columns: repeat(4, 1fr); padding: 0 24px 24px; max-width: 860px; margin: 0 auto; width: 100%; } }

    .doc-card {
      background: var(--bg-card);
      border: 1.5px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 18px 14px 16px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 10px;
      cursor: pointer;
      transition: border-color .18s, box-shadow .18s, transform .18s var(--ease-out);
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }
    .doc-card:hover {
      border-color: var(--accent-light);
      box-shadow: var(--shadow);
      transform: translateY(-2px);
    }
    .doc-card:active { transform: scale(.97); }

    .doc-icon {
      width: 44px;
      height: 44px;
      background: var(--accent-bg);
      border-radius: var(--radius);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.4rem;
      flex-shrink: 0;
    }

    .doc-info { flex: 1; }
    .doc-name {
      font-size: .85rem;
      font-weight: 600;
      color: var(--ink);
      line-height: 1.25;
      margin-bottom: 4px;
    }
    .doc-desc {
      font-size: .75rem;
      color: var(--ink-3);
      line-height: 1.4;
    }

    /* â”€â”€â”€ DISCLAIMER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .disclaimer {
      margin: 0 16px 16px;
      padding: 10px 14px;
      background: var(--warn-bg);
      border: 1px solid var(--warn-border);
      border-radius: var(--radius);
      display: flex;
      align-items: flex-start;
      gap: 8px;
    }
    .disclaimer-icon { font-size: 1rem; flex-shrink: 0; margin-top: 1px; }
    .disclaimer p {
      font-size: .75rem;
      color: var(--warn-ink);
      line-height: 1.45;
    }
    .disclaimer strong { font-weight: 600; }
    @media (min-width: 768px) { .disclaimer { max-width: 812px; margin: 0 auto 20px; width: calc(100% - 48px); } }

    /* â”€â”€â”€ CHAT VIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .chat-view {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .chat-header {
      padding: 14px 16px;
      background: var(--bg-card);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 12px;
      position: sticky;
      top: 0;
      z-index: 5;
    }
    .btn-back {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: var(--surface);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: background .15s;
    }
    .btn-back:hover { background: var(--border); }
    .btn-back svg { width: 16px; height: 16px; }

    .chat-header-info { flex: 1; min-width: 0; }
    .chat-doc-name {
      font-size: .9rem;
      font-weight: 600;
      color: var(--ink);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .chat-step-label {
      font-size: .72rem;
      color: var(--ink-3);
      margin-top: 1px;
    }

    .progress-bar {
      height: 3px;
      background: var(--border);
      border-radius: 2px;
      overflow: hidden;
      margin-top: 10px;
    }
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--accent-light));
      border-radius: 2px;
      transition: width .4s var(--ease-out);
    }

    /* â”€â”€â”€ CHAT BODY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .chat-body {
      flex: 1;
      overflow-y: auto;
      padding: 24px 16px 16px;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }
    @media (min-width: 640px) { .chat-body { max-width: 640px; margin: 0 auto; width: 100%; } }

    /* Current question â€” big, centered */
    .question-block {
      text-align: center;
      animation: fadeUp .4s var(--ease-out) both;
    }
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(12px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .question-chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: var(--accent-bg);
      color: var(--accent);
      font-size: .72rem;
      font-weight: 600;
      letter-spacing: .04em;
      text-transform: uppercase;
      padding: 4px 10px;
      border-radius: 20px;
      margin-bottom: 14px;
    }

    .question-text {
      font-family: var(--font-display);
      font-size: clamp(1.3rem, 4vw, 1.7rem);
      line-height: 1.25;
      color: var(--ink);
      letter-spacing: -.01em;
      margin-bottom: 8px;
    }
    .question-hint {
      font-size: .8rem;
      color: var(--ink-3);
    }

    /* Answered items */
    .answered-section {
      border-top: 1px solid var(--border);
      padding-top: 20px;
    }
    .answered-label {
      font-size: .7rem;
      font-weight: 600;
      letter-spacing: .06em;
      text-transform: uppercase;
      color: var(--ink-muted);
      margin-bottom: 10px;
    }
    .answered-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .answered-item {
      display: flex;
      align-items: baseline;
      gap: 8px;
      font-size: .82rem;
      animation: fadeUp .3s var(--ease-out) both;
    }
    .answered-key {
      color: var(--ink-3);
      flex-shrink: 0;
      min-width: 0;
    }
    .answered-val {
      color: var(--ink);
      font-weight: 500;
    }
    .answered-check {
      color: var(--accent-light);
      flex-shrink: 0;
      font-size: .9rem;
    }

    /* Loading dots */
    .typing-indicator {
      display: flex;
      gap: 5px;
      align-items: center;
      justify-content: center;
      padding: 20px 0;
    }
    .typing-dot {
      width: 7px; height: 7px;
      background: var(--accent-light);
      border-radius: 50%;
      animation: bounce .8s infinite;
    }
    .typing-dot:nth-child(2) { animation-delay: .15s; }
    .typing-dot:nth-child(3) { animation-delay: .3s; }
    @keyframes bounce {
      0%, 80%, 100% { transform: scale(.6); opacity: .4; }
      40%            { transform: scale(1);  opacity: 1; }
    }

    /* â”€â”€â”€ CHAT FOOTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .chat-footer {
      background: var(--bg-card);
      border-top: 1px solid var(--border);
      padding: 12px 16px;
      padding-bottom: max(12px, env(safe-area-inset-bottom));
    }
    @media (min-width: 640px) {
      .chat-footer > * { max-width: 640px; margin: 0 auto; }
    }

    .chat-input-row {
      display: flex;
      gap: 10px;
      align-items: flex-end;
    }
    .chat-input {
      flex: 1;
      background: var(--surface);
      border: 1.5px solid var(--border);
      border-radius: var(--radius);
      padding: 12px 14px;
      font-size: .9rem;
      color: var(--ink);
      resize: none;
      min-height: 46px;
      max-height: 120px;
      outline: none;
      transition: border-color .15s;
      line-height: 1.4;
    }
    .chat-input:focus { border-color: var(--accent); background: var(--bg-card); }
    .chat-input::placeholder { color: var(--ink-muted); }

    .btn-send {
      width: 46px;
      height: 46px;
      background: var(--accent);
      border-radius: var(--radius);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: background .15s, transform .1s;
    }
    .btn-send:hover { background: var(--accent-hover); }
    .btn-send:active { transform: scale(.93); }
    .btn-send:disabled { background: var(--border); pointer-events: none; }
    .btn-send svg { width: 18px; height: 18px; }

    .chat-disclaimer {
      margin-top: 8px;
      font-size: .68rem;
      color: var(--ink-muted);
      text-align: center;
      line-height: 1.4;
    }

    /* â”€â”€â”€ REMOVED: API KEY OVERLAY (key is now server-side) â”€â”€â”€ */

    /* â”€â”€â”€ PREVIEW VIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .preview-view {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .preview-header {
      padding: 14px 16px;
      background: var(--bg-card);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .preview-title {
      font-size: .9rem;
      font-weight: 600;
      flex: 1;
    }

    .preview-body {
      flex: 1;
      overflow-y: auto;
      padding: 20px 16px;
    }
    @media (min-width: 640px) { .preview-body { max-width: 700px; margin: 0 auto; width: 100%; } }

    .doc-paper {
      background: white;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 32px 24px;
      box-shadow: var(--shadow-sm);
      font-size: .88rem;
      line-height: 1.75;
      color: var(--ink-2);
      white-space: pre-wrap;
      font-family: 'Georgia', serif;
      min-height: 400px;
    }
    @media (min-width: 480px) { .doc-paper { padding: 40px 36px; } }

    .preview-footer {
      background: var(--bg-card);
      border-top: 1px solid var(--border);
      padding: 16px;
      padding-bottom: max(16px, env(safe-area-inset-bottom));
      display: flex;
      gap: 10px;
    }
    @media (min-width: 640px) {
      .preview-footer { max-width: 700px; margin: 0 auto; width: 100%; border-top: none; }
    }

    .btn-download {
      flex: 1;
      background: var(--accent);
      color: white;
      border-radius: var(--radius);
      padding: 14px;
      font-size: .9rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: background .15s;
    }
    .btn-download:hover { background: var(--accent-hover); }
    .btn-download svg { width: 18px; height: 18px; }

    .btn-restart {
      background: var(--surface);
      color: var(--ink-2);
      border: 1.5px solid var(--border);
      border-radius: var(--radius);
      padding: 14px 18px;
      font-size: .9rem;
      font-weight: 500;
      transition: background .15s;
    }
    .btn-restart:hover { background: var(--border); }

    /* â”€â”€â”€ GENERATING STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .generating-overlay {
      position: fixed;
      inset: 0;
      background: rgba(244,245,240,.9);
      z-index: 50;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 20px;
      animation: fadeIn .2s ease;
    }
    .generating-overlay.hidden { display: none; }
    .generating-spinner {
      width: 48px;
      height: 48px;
      border: 3px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .generating-text {
      font-family: var(--font-display);
      font-size: 1.2rem;
      color: var(--ink);
      text-align: center;
    }
    .generating-sub {
      font-size: .82rem;
      color: var(--ink-3);
      text-align: center;
    }

    /* â”€â”€â”€ ERROR TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%) translateY(20px);
      background: #2D2D2D;
      color: white;
      padding: 12px 20px;
      border-radius: var(--radius);
      font-size: .85rem;
      z-index: 200;
      opacity: 0;
      pointer-events: none;
      transition: all .3s var(--ease-out);
      white-space: nowrap;
      max-width: calc(100vw - 40px);
      text-align: center;
    }
    .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

    /* Scroll padding for chat */
    .chat-body { scroll-padding-bottom: 20px; }
  </style>
</head>
<body>

<!-- API KEY: reemplazÃ¡ YOUR_KEY_HERE con tu clave de Anthropic antes de publicar -->

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     GENERATING OVERLAY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="generating-overlay hidden" id="generatingOverlay">
  <div class="generating-spinner"></div>
  <p class="generating-text">Redactando tu documentoâ€¦</p>
  <p class="generating-sub">Esto tarda unos segundos</p>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="toast" id="toast"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     APP SHELL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="app-shell">

  <!-- â”€â”€â”€ HEADER (solo en home) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <header class="header" id="mainHeader">
    <div class="logo">
      <div class="logo-mark">
        <!-- Document + sparkle SVG -->
        <svg viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="3" y="2" width="10" height="13" rx="1.5" fill="white" opacity=".25"/>
          <rect x="3" y="2" width="10" height="13" rx="1.5" stroke="white" stroke-width="1.4"/>
          <line x1="6" y1="6" x2="10" y2="6" stroke="white" stroke-width="1.2" stroke-linecap="round"/>
          <line x1="6" y1="8.5" x2="10" y2="8.5" stroke="white" stroke-width="1.2" stroke-linecap="round"/>
          <line x1="6" y1="11" x2="8.5" y2="11" stroke="white" stroke-width="1.2" stroke-linecap="round"/>
          <circle cx="14" cy="4" r="2.5" fill="#52B788"/>
          <path d="M14 2.8v2.4M12.8 4h2.4" stroke="white" stroke-width="1" stroke-linecap="round"/>
        </svg>
      </div>
      <span class="logo-name">Formulario<span>.ia</span></span>
    </div>
    <span class="badge-free">Gratis</span>
  </header>

  <!-- â”€â”€â”€ VIEW: HOME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="view active" id="viewHome">

    <div class="home-hero">
      <h1>Documentos legales<br>en <em>minutos</em>, con IA</h1>
      <p>ElegÃ­ el documento que necesitÃ¡s, respondÃ© unas preguntas simples y descargÃ¡ el PDF listo.</p>
    </div>

    <p class="section-label">Â¿QuÃ© necesitÃ¡s hoy?</p>

    <div class="doc-grid" id="docGrid">
      <!-- Generado por JS -->
    </div>

    <div class="disclaimer">
      <span class="disclaimer-icon">âš ï¸</span>
      <p><strong>Importante:</strong> Los documentos generados son borradores orientativos. ConsultÃ¡ con un profesional antes de firmarlo.</p>
    </div>

  </div>

  <!-- â”€â”€â”€ VIEW: CHAT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="view" id="viewChat">
    <div class="chat-view">

      <div class="chat-header">
        <button class="btn-back" id="chatBackBtn" aria-label="Volver">
          <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <path d="M10 3L5 8l5 5"/>
          </svg>
        </button>
        <div class="chat-header-info">
          <div class="chat-doc-name" id="chatDocName"></div>
          <div class="chat-step-label" id="chatStepLabel"></div>
          <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
        </div>
      </div>

      <div class="chat-body" id="chatBody">
        <!-- Pregunta actual y respondidas aquÃ­ -->
      </div>

      <div class="chat-footer">
        <div class="chat-input-row">
          <textarea
            class="chat-input"
            id="chatInput"
            placeholder="EscribÃ­ tu respuestaâ€¦"
            rows="1"
          ></textarea>
          <button class="btn-send" id="sendBtn" aria-label="Enviar">
            <svg viewBox="0 0 18 18" fill="none" stroke="white" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
              <path d="M15 9H3M9 3l6 6-6 6"/>
            </svg>
          </button>
        </div>
        <p class="chat-disclaimer">âš ï¸ Borrador orientativo â€” consultÃ¡ con un profesional antes de firmarlo.</p>
      </div>

    </div>
  </div>

  <!-- â”€â”€â”€ VIEW: PREVIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="view" id="viewPreview">
    <div class="preview-view">

      <div class="preview-header">
        <button class="btn-back" id="previewBackBtn" aria-label="Volver">
          <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <path d="M10 3L5 8l5 5"/>
          </svg>
        </button>
        <div class="preview-title" id="previewTitle"></div>
      </div>

      <div class="preview-body">
        <div class="doc-paper" id="docPaper"></div>
      </div>

      <div class="preview-footer">
        <button class="btn-restart" id="previewRestartBtn">â† Nuevo</button>
        <button class="btn-download" id="downloadBtn">
          <svg viewBox="0 0 18 18" fill="none" stroke="white" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <path d="M9 3v9M5 8l4 4 4-4"/>
            <path d="M3 14h12"/>
          </svg>
          Descargar PDF
        </button>
      </div>

    </div>
  </div>

</div><!-- /app-shell -->

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     JAVASCRIPT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONFIGURACIÃ“N â€” reemplazÃ¡ con tu key de Google
   ObtenÃ© tu key gratis en: aistudio.google.com
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const GEMINI_KEY = 'YOUR_GEMINI_KEY_HERE'; // â† pegÃ¡ tu key acÃ¡
const GEMINI_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_KEY}`;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CATÃLOGO DE DOCUMENTOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const DOCUMENTS = [
  {
    id: 'contrato_alquiler',
    nombre: 'Contrato de Alquiler',
    icono: 'ğŸ ',
    descripcion: 'Alquiler de inmueble entre partes',
    preguntas: [
      { key: 'propietario_nombre',   label: 'Nombre completo del propietario',          hint: 'Tal como figura en el DNI' },
      { key: 'propietario_dni',      label: 'DNI del propietario',                       hint: 'Sin puntos ni espacios' },
      { key: 'inquilino_nombre',     label: 'Nombre completo del inquilino',             hint: null },
      { key: 'inquilino_dni',        label: 'DNI del inquilino',                         hint: null },
      { key: 'inmueble_direccion',   label: 'DirecciÃ³n exacta del inmueble',             hint: 'Calle, nÃºmero, piso/depto, localidad, provincia' },
      { key: 'alquiler_monto',       label: 'Monto mensual del alquiler',                hint: 'En pesos o dÃ³lares, ej: $150.000' },
      { key: 'alquiler_duracion',    label: 'Â¿CuÃ¡nto dura el contrato?',                 hint: 'Ej: 2 aÃ±os, desde el 1/3/2025' },
      { key: 'deposito',             label: 'DepÃ³sito de garantÃ­a',                      hint: 'Ej: un mes de alquiler' },
    ],
    promptSistema: `Eres un asistente legal argentino. GenerÃ¡s contratos de alquiler en espaÃ±ol rioplatense formal, siguiendo la Ley de Alquileres argentina.
Cuando el usuario haya respondido todas las preguntas, generÃ¡ el contrato completo con: datos de las partes, descripciÃ³n del inmueble, monto y condiciones de pago, duraciÃ³n, depÃ³sito, clÃ¡usulas estÃ¡ndar (uso del inmueble, servicios, rescisiÃ³n, prÃ³rroga), y espacios para firmas.
UsÃ¡ formato legal claro, con secciones numeradas. Al final incluÃ­ el disclaimer: "DOCUMENTO GENERADO POR IA â€” BORRADOR ORIENTATIVO. Consulte con un profesional antes de suscribir."`,
  },
  {
    id: 'carta_documento',
    nombre: 'Carta Documento',
    icono: 'ğŸ“®',
    descripcion: 'NotificaciÃ³n formal con valor legal',
    preguntas: [
      { key: 'remitente_nombre',   label: 'Â¿QuiÃ©n envÃ­a la carta documento?',         hint: 'Tu nombre completo o razÃ³n social' },
      { key: 'remitente_dni',      label: 'DNI o CUIT del remitente',                  hint: null },
      { key: 'destinatario_nombre',label: 'Â¿A quiÃ©n va dirigida?',                     hint: 'Nombre completo o razÃ³n social' },
      { key: 'destinatario_dir',   label: 'Domicilio del destinatario',                hint: 'DirecciÃ³n donde se enviarÃ¡' },
      { key: 'motivo',             label: 'Â¿CuÃ¡l es el motivo de la carta documento?', hint: 'Explicalo con tus palabras, sin tecnicismos' },
      { key: 'reclamo_detalle',    label: 'Â¿QuÃ© pedÃ­s o reclamÃ¡s exactamente?',        hint: 'SÃ© especÃ­fico: monto, plazo, acciÃ³n concreta' },
      { key: 'plazo_respuesta',    label: 'Â¿QuÃ© plazo le das para responder?',         hint: 'Ej: 5 dÃ­as hÃ¡biles' },
    ],
    promptSistema: `Eres un asistente legal argentino. RedactÃ¡s cartas documento en espaÃ±ol rioplatense formal y legal.
Con los datos del usuario, generÃ¡ una carta documento completa: encabezado formal, identificaciÃ³n de las partes, exposiciÃ³n clara de los hechos, la intimaciÃ³n o reclamo concreto, el plazo otorgado, y las consecuencias legales de no cumplir.
UsÃ¡ el tono formal propio de las cartas documento argentinas. Al final incluÃ­: "DOCUMENTO GENERADO POR IA â€” BORRADOR ORIENTATIVO."`,
  },
  {
    id: 'autorizacion_menor',
    nombre: 'AutorizaciÃ³n para Menor',
    icono: 'âœˆï¸',
    descripcion: 'Para que un menor viaje sin tutores',
    preguntas: [
      { key: 'menor_nombre',       label: 'Nombre completo del menor',                 hint: null },
      { key: 'menor_dni',          label: 'DNI del menor',                             hint: null },
      { key: 'menor_nacimiento',   label: 'Fecha de nacimiento del menor',             hint: 'DD/MM/AAAA' },
      { key: 'padre_nombre',       label: 'Nombre del padre / tutor que autoriza',     hint: null },
      { key: 'padre_dni',          label: 'DNI del padre / tutor',                     hint: null },
      { key: 'madre_nombre',       label: 'Nombre de la madre / tutora (si aplica)',   hint: 'EscribÃ­ "no aplica" si no corresponde' },
      { key: 'madre_dni',          label: 'DNI de la madre / tutora',                  hint: 'O escribÃ­ "no aplica"' },
      { key: 'acompanante',        label: 'Â¿Con quiÃ©n viaja el menor?',               hint: 'Nombre y DNI del acompaÃ±ante adulto' },
      { key: 'destino',            label: 'Destino del viaje',                         hint: 'PaÃ­s, ciudad o provincia' },
      { key: 'fecha_viaje',        label: 'Fechas del viaje',                          hint: 'Ida y vuelta, ej: del 10 al 20 de enero de 2025' },
    ],
    promptSistema: `Eres un asistente legal argentino. RedactÃ¡s autorizaciones para viaje de menores segÃºn la normativa del Registro Nacional de las Personas (RENAPER) y Migraciones Argentina.
GenerÃ¡ el documento completo con: identificaciÃ³n del menor, datos de los padres/tutores, identificaciÃ³n del acompaÃ±ante, destino y fechas, declaraciÃ³n de autorizaciÃ³n expresa, y la nota de que debe ser certificado ante escribano o comisarÃ­a para tener validez plena.
Al final incluÃ­: "DOCUMENTO GENERADO POR IA â€” BORRADOR ORIENTATIVO. Este documento debe ser certificado ante escribano o autoridad policial para su validez."`,
  },
  {
    id: 'renuncia_laboral',
    nombre: 'Carta de Renuncia',
    icono: 'ğŸ“',
    descripcion: 'Renuncia laboral con fuerza legal',
    preguntas: [
      { key: 'empleado_nombre',  label: 'Tu nombre completo',                          hint: 'Tal como figura en tu recibo de sueldo' },
      { key: 'empleado_dni',     label: 'Tu DNI',                                      hint: null },
      { key: 'empresa_nombre',   label: 'Nombre de la empresa',                        hint: null },
      { key: 'empleador_nombre', label: 'Nombre del empleador o responsable de RRHH',  hint: 'A quien va dirigida' },
      { key: 'cargo',            label: 'Â¿CuÃ¡l es tu cargo actual?',                   hint: 'Ej: Vendedor, Administrativo, Gerente' },
      { key: 'fecha_inicio',     label: 'Fecha de ingreso a la empresa',               hint: 'DD/MM/AAAA' },
      { key: 'fecha_efectiva',   label: 'Â¿CuÃ¡ndo se hace efectiva la renuncia?',       hint: 'La Ley exige 15 dÃ­as de preaviso como mÃ­nimo' },
    ],
    promptSistema: `Eres un asistente legal argentino especializado en derecho laboral. RedactÃ¡s cartas de renuncia segÃºn la LCT (Ley de Contrato de Trabajo), Art. 240.
GenerÃ¡ la carta de renuncia completa: lugar y fecha, destinatario, cuerpo formal con la expresiÃ³n de renuncia, cargo, fecha efectiva respetando el preaviso legal, y solicitud de liquidaciÃ³n final.
UsÃ¡ tono formal pero correcto. Al final incluÃ­: "DOCUMENTO GENERADO POR IA â€” BORRADOR ORIENTATIVO. Recomendamos enviarla por telegrama colacionado o carta documento para tener prueba fehaciente."`,
  },
  {
    id: 'acuerdo_cuotas',
    nombre: 'Acuerdo en Cuotas',
    icono: 'ğŸ¤',
    descripcion: 'Plan de pago entre deudor y acreedor',
    preguntas: [
      { key: 'acreedor_nombre',  label: 'Nombre del acreedor (quien cobra)',            hint: 'Persona o empresa que recibe el pago' },
      { key: 'acreedor_dni',     label: 'DNI o CUIT del acreedor',                     hint: null },
      { key: 'deudor_nombre',    label: 'Nombre del deudor (quien paga)',               hint: null },
      { key: 'deudor_dni',       label: 'DNI del deudor',                               hint: null },
      { key: 'deuda_monto',      label: 'Monto total de la deuda',                      hint: 'En pesos o dÃ³lares, ej: $500.000' },
      { key: 'deuda_origen',     label: 'Â¿Por quÃ© se originÃ³ la deuda?',               hint: 'Ej: prÃ©stamo personal, mercaderÃ­a, servicios' },
      { key: 'cuotas_cantidad',  label: 'Â¿En cuÃ¡ntas cuotas se pagarÃ¡?',               hint: null },
      { key: 'cuota_monto',      label: 'Monto de cada cuota',                          hint: null },
      { key: 'primer_vencimiento',label: 'Fecha del primer vencimiento',               hint: 'DD/MM/AAAA' },
    ],
    promptSistema: `Eres un asistente legal argentino. RedactÃ¡s acuerdos de pago en cuotas de forma clara y legalmente vÃ¡lida.
GenerÃ¡ el acuerdo completo: identificaciÃ³n de las partes, reconocimiento de deuda, plan de cuotas detallado (tabla con nÃºmero, monto y vencimiento), penalidad por mora, domicilios constituidos, y clÃ¡usula de rescisiÃ³n anticipada.
IncluÃ­ espacio para firmas con aclaraciÃ³n y fecha. Al final: "DOCUMENTO GENERADO POR IA â€” BORRADOR ORIENTATIVO."`,
  },
  {
    id: 'baja_servicio',
    nombre: 'Solicitud de Baja',
    icono: 'ğŸš«',
    descripcion: 'Baja de servicio o suscripciÃ³n',
    preguntas: [
      { key: 'cliente_nombre',   label: 'Tu nombre completo',                          hint: null },
      { key: 'cliente_dni',      label: 'Tu DNI o CUIT',                               hint: null },
      { key: 'empresa',          label: 'Â¿A quÃ© empresa le pedÃ­s la baja?',            hint: 'Ej: Telecentro, Personal, Netflix, gimnasio' },
      { key: 'servicio',         label: 'Â¿QuÃ© servicio o producto querÃ©s dar de baja?',hint: 'SÃ© especÃ­fico' },
      { key: 'numero_cliente',   label: 'NÃºmero de cliente o contrato',                hint: 'Figura en tu factura o contrato' },
      { key: 'motivo',           label: 'Â¿CuÃ¡l es el motivo de la baja?',              hint: 'No estÃ¡s obligado, pero ayuda a tu reclamo' },
      { key: 'fecha_efectiva',   label: 'Â¿CuÃ¡ndo querÃ©s que sea efectiva la baja?',   hint: 'Ej: a partir de la fecha de recepciÃ³n' },
    ],
    promptSistema: `Eres un asistente legal argentino. RedactÃ¡s solicitudes de baja de servicio invocando los derechos del consumidor segÃºn la Ley 24.240 de Defensa del Consumidor.
GenerÃ¡ la nota completa: datos del solicitante, identificaciÃ³n del servicio, solicitud formal de baja, fecha efectiva, plazo que le otorgÃ¡s para confirmar (48hs hÃ¡biles), y advertencia de que en caso de incumplimiento se iniciarÃ¡ denuncia ante SIGEN/organismos de defensa del consumidor.
Al final: "DOCUMENTO GENERADO POR IA â€” BORRADOR ORIENTATIVO."`,
  },
  {
    id: 'poder_simple',
    nombre: 'Poder Simple',
    icono: 'âš–ï¸',
    descripcion: 'AutorizaciÃ³n para actuar en tu nombre',
    preguntas: [
      { key: 'poderdante_nombre',label: 'Tu nombre completo (quien da el poder)',       hint: null },
      { key: 'poderdante_dni',   label: 'Tu DNI',                                      hint: null },
      { key: 'poderdante_dir',   label: 'Tu domicilio',                                hint: null },
      { key: 'apoderado_nombre', label: 'Nombre de quien recibe el poder',             hint: 'A quiÃ©n autorizÃ¡s a actuar' },
      { key: 'apoderado_dni',    label: 'DNI del apoderado',                           hint: null },
      { key: 'facultades',       label: 'Â¿Para quÃ© lo autorizÃ¡s exactamente?',         hint: 'Ej: cobrar cheques, firmar documentos, gestionar trÃ¡mite X' },
      { key: 'vigencia',         label: 'Â¿Hasta cuÃ¡ndo tiene vigencia el poder?',      hint: 'Ej: hasta el 31/12/2025, o "por tiempo indeterminado"' },
    ],
    promptSistema: `Eres un asistente legal argentino. RedactÃ¡s poderes simples (instrumento privado) segÃºn el CÃ³digo Civil y Comercial argentino.
GenerÃ¡ el poder completo: declaraciÃ³n del poderdante, identificaciÃ³n de las partes, descripciÃ³n precisa de las facultades otorgadas, limitaciones si las hay, vigencia, y espacio para firma con certificaciÃ³n notarial.
IncluÃ­ nota importante: para ciertos trÃ¡mites (bancarios, inmobiliarios, etc.) puede requerirse poder ante escribano pÃºblico.
Al final: "DOCUMENTO GENERADO POR IA â€” BORRADOR ORIENTATIVO. Consulte con un escribano para determinar si este documento requiere autenticaciÃ³n notarial."`,
  },
  {
    id: 'nota_reclamo',
    nombre: 'Nota de Reclamo',
    icono: 'ğŸ“£',
    descripcion: 'Reclamo formal ante empresa o persona',
    preguntas: [
      { key: 'reclamante_nombre',label: 'Tu nombre completo',                          hint: null },
      { key: 'reclamante_dni',   label: 'Tu DNI o CUIT',                               hint: null },
      { key: 'reclamante_dir',   label: 'Tu domicilio',                                hint: 'Para que puedan responderte' },
      { key: 'reclamado',        label: 'Â¿A quiÃ©n le reclamÃ¡s?',                       hint: 'Empresa, persona, organismo' },
      { key: 'hecho',            label: 'Â¿QuÃ© pasÃ³? DescribÃ­ el problema',             hint: 'Con fechas y detalles concretos' },
      { key: 'perjuicio',        label: 'Â¿QuÃ© daÃ±o o perjuicio sufriste?',             hint: 'EconÃ³mico, servicio no prestado, producto defectuoso, etc.' },
      { key: 'solucion',         label: 'Â¿QuÃ© soluciÃ³n pedÃ­s?',                        hint: 'Ej: reembolso de $X, reparaciÃ³n, cumplimiento del contrato' },
      { key: 'plazo',            label: 'Â¿QuÃ© plazo le das para resolver?',            hint: 'Ej: 5 dÃ­as hÃ¡biles' },
    ],
    promptSistema: `Eres un asistente legal argentino. RedactÃ¡s notas de reclamo formales y efectivas, invocando cuando corresponde la Ley 24.240 de Defensa del Consumidor.
GenerÃ¡ la nota completa: identificaciÃ³n del reclamante y reclamado, exposiciÃ³n clara y cronolÃ³gica de los hechos, el perjuicio sufrido, la soluciÃ³n exigida, el plazo otorgado, y advertencia de acciones legales y/o denuncia ante organismos competentes (Defensa del Consumidor, ENACOM, etc.) en caso de incumplimiento.
UsÃ¡ tono firme pero profesional. Al final: "DOCUMENTO GENERADO POR IA â€” BORRADOR ORIENTATIVO."`,
  },

  /* â”€â”€ NUEVOS DOCUMENTOS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

  {
    id: 'constancia_alumno',
    nombre: 'Constancia de Alumno',
    icono: 'ğŸ“',
    descripcion: 'Constancia de alumno regular',
    preguntas: [
      { key: 'alumno_nombre',    label: 'Â¿CuÃ¡l es tu nombre completo?',                hint: null },
      { key: 'alumno_dni',       label: 'Tu DNI',                                      hint: null },
      { key: 'institucion',      label: 'Â¿En quÃ© instituciÃ³n estudiÃ¡s?',               hint: 'Nombre completo del colegio, instituto o universidad' },
      { key: 'carrera_curso',    label: 'Â¿QuÃ© carrera o curso cursÃ¡s?',                hint: 'Ej: AbogacÃ­a, 5Â° aÃ±o Secundario, Tecnicatura en DiseÃ±o' },
      { key: 'anio_cursada',     label: 'Â¿En quÃ© aÃ±o o nivel estÃ¡s?',                  hint: 'Ej: 3er aÃ±o, 1er cuatrimestre 2025' },
      { key: 'turno',            label: 'Â¿En quÃ© turno cursÃ¡s?',                       hint: 'MaÃ±ana, tarde, noche o virtual' },
      { key: 'destinatario',     label: 'Â¿A quiÃ©n va dirigida la constancia?',         hint: 'Ej: empleador, banco, obra social, trÃ¡mite migratorio' },
    ],
    promptSistema: `Eres un asistente administrativo argentino. RedactÃ¡s constancias de alumno regular en espaÃ±ol formal.
GenerÃ¡ la constancia completa con: membrete de la instituciÃ³n (con espacio para completar), nÃºmero de constancia, datos del alumno, carrera/curso, aÃ±o lectivo en curso, estado regular, destinatario, lugar y fecha, y espacio para firma y sello de autoridad acadÃ©mica.
IncluÃ­ una nota: "La presente constancia tiene validez por 30 dÃ­as desde su emisiÃ³n."
Al final: "DOCUMENTO GENERADO POR IA â€” BORRADOR ORIENTATIVO. Debe ser completada y firmada por la instituciÃ³n educativa."`,
  },

  {
    id: 'permiso_salida',
    nombre: 'Permiso Salida Escolar',
    icono: 'ğŸšŒ',
    descripcion: 'AutorizaciÃ³n para evento o excursiÃ³n',
    preguntas: [
      { key: 'alumno_nombre',    label: 'Nombre completo del alumno/a',                hint: null },
      { key: 'alumno_dni',       label: 'DNI del alumno/a',                            hint: null },
      { key: 'grado_curso',      label: 'Â¿En quÃ© grado o curso estÃ¡?',                hint: 'Ej: 4Â° B, 2Â° aÃ±o secundario' },
      { key: 'institucion',      label: 'Nombre de la instituciÃ³n educativa',          hint: null },
      { key: 'evento',           label: 'Â¿A quÃ© evento o salida va?',                 hint: 'Ej: visita al museo, campamento, obra de teatro' },
      { key: 'destino',          label: 'Â¿CuÃ¡l es el destino?',                       hint: 'Lugar o direcciÃ³n' },
      { key: 'fecha_hora',       label: 'Fecha y horario del evento',                  hint: 'Ej: 15/05/2025 de 9hs a 17hs' },
      { key: 'padre_madre',      label: 'Nombre del padre/madre/tutor que autoriza',   hint: null },
      { key: 'padre_dni',        label: 'DNI del padre/madre/tutor',                  hint: null },
    ],
    promptSistema: `Eres un asistente educativo argentino. RedactÃ¡s autorizaciones para salidas o eventos escolares.
GenerÃ¡ el formulario completo: datos del alumno, instituciÃ³n, descripciÃ³n del evento, destino, fechas y horarios, declaraciÃ³n del tutor autorizando la participaciÃ³n, aclaraciÃ³n de que el alumno puede recibir primeros auxilios en caso de emergencia, y datos de contacto del tutor para emergencias.
Formato de formulario con casilleros para completar donde corresponda.
Al final: "DOCUMENTO GENERADO POR IA â€” BORRADOR ORIENTATIVO. Debe ser entregado a la instituciÃ³n con firma del tutor."`,
  },

  {
    id: 'convivencia_comparte',
    nombre: 'Acuerdo de Convivencia',
    icono: 'ğŸ¡',
    descripcion: 'Reglas entre personas que comparten piso',
    preguntas: [
      { key: 'persona1_nombre',  label: 'Nombre de la primera persona',                hint: null },
      { key: 'persona1_dni',     label: 'DNI de la primera persona',                  hint: null },
      { key: 'persona2_nombre',  label: 'Nombre de la segunda persona',               hint: null },
      { key: 'persona2_dni',     label: 'DNI de la segunda persona',                  hint: null },
      { key: 'persona3',         label: 'Â¿Hay mÃ¡s personas en el acuerdo?',           hint: 'Nombre y DNI, o escribÃ­ "no" si son solo dos' },
      { key: 'domicilio',        label: 'DirecciÃ³n del inmueble compartido',           hint: null },
      { key: 'gastos_comunes',   label: 'Â¿CÃ³mo se dividen los gastos comunes?',       hint: 'Ej: en partes iguales, segÃºn el cuarto ocupado' },
      { key: 'limpieza',         label: 'Â¿CÃ³mo organizan la limpieza?',               hint: 'Ej: turnos semanales, cada uno limpia lo suyo' },
      { key: 'visitas',          label: 'Â¿Hay reglas sobre visitas o ruidos?',        hint: 'Ej: sin visitas despuÃ©s de las 23hs, avisar con anticipaciÃ³n' },
      { key: 'vigencia',         label: 'Â¿CuÃ¡nto dura el acuerdo?',                   hint: 'Ej: mientras dure la convivencia, 1 aÃ±o' },
    ],
    promptSistema: `Eres un asistente legal argentino. RedactÃ¡s acuerdos de convivencia entre personas que comparten vivienda, en tono claro y directo (no excesivamente formal, pero sÃ­ vinculante).
GenerÃ¡ el acuerdo completo con: identificaciÃ³n de las partes, direcciÃ³n del inmueble, secciones sobre: gastos y servicios, limpieza y orden, uso de espacios comunes, visitas y ruidos, privacidad, resoluciÃ³n de conflictos, y vigencia del acuerdo.
IncluÃ­ clÃ¡usula de modificaciÃ³n por acuerdo escrito de todas las partes.
Al final: "DOCUMENTO GENERADO POR IA â€” BORRADOR ORIENTATIVO."`,
  },

  {
    id: 'prestamo_dinero',
    nombre: 'PrÃ©stamo de Dinero',
    icono: 'ğŸ’¸',
    descripcion: 'Contrato entre prestamista y deudor',
    preguntas: [
      { key: 'prestamista_nombre',label: 'Nombre del prestamista (quien presta)',      hint: 'La persona que da el dinero' },
      { key: 'prestamista_dni',  label: 'DNI del prestamista',                        hint: null },
      { key: 'deudor_nombre',    label: 'Nombre del deudor (quien recibe)',            hint: null },
      { key: 'deudor_dni',       label: 'DNI del deudor',                             hint: null },
      { key: 'monto',            label: 'Â¿CuÃ¡nto dinero se presta?',                  hint: 'En pesos o dÃ³lares, ej: $200.000' },
      { key: 'fecha_entrega',    label: 'Â¿CuÃ¡ndo se entrega el dinero?',              hint: 'DD/MM/AAAA o "a la firma del contrato"' },
      { key: 'forma_devolucion', label: 'Â¿CÃ³mo se devuelve?',                         hint: 'Ej: en un solo pago, en cuotas mensuales' },
      { key: 'fecha_devolucion', label: 'Â¿CuÃ¡ndo debe devolverse?',                   hint: 'Fecha lÃ­mite o cantidad de cuotas' },
      { key: 'interes',          label: 'Â¿Se cobra interÃ©s?',                          hint: 'Ej: sin interÃ©s, o 5% mensual. EscribÃ­ "sin interÃ©s" si no aplica' },
    ],
    promptSistema: `Eres un asistente legal argentino. RedactÃ¡s contratos de mutuo (prÃ©stamo de dinero) segÃºn el CÃ³digo Civil y Comercial argentino, Arts. 1525-1532.
GenerÃ¡ el contrato completo con: identificaciÃ³n de las partes, monto prestado (en letras y nÃºmeros), fecha y forma de entrega, plan de devoluciÃ³n, tasa de interÃ©s compensatorio y punitorio si aplica, mora automÃ¡tica, domicilios constituidos, y espacio para firmas con fecha.
Al final: "DOCUMENTO GENERADO POR IA â€” BORRADOR ORIENTATIVO. Para mayor seguridad jurÃ­dica, se recomienda la certificaciÃ³n de firmas ante escribano."`,
  },

  {
    id: 'autorizacion_tatuaje',
    nombre: 'AutorizaciÃ³n Tatuaje/Piercing',
    icono: 'ğŸ¨',
    descripcion: 'Permiso parental para menores de edad',
    preguntas: [
      { key: 'menor_nombre',     label: 'Nombre completo del menor',                  hint: null },
      { key: 'menor_dni',        label: 'DNI del menor',                              hint: null },
      { key: 'menor_nacimiento', label: 'Fecha de nacimiento del menor',              hint: 'DD/MM/AAAA' },
      { key: 'tutor_nombre',     label: 'Nombre del padre/madre/tutor que autoriza',  hint: null },
      { key: 'tutor_dni',        label: 'DNI del tutor',                              hint: null },
      { key: 'tutor_vinculo',    label: 'Â¿QuÃ© vÃ­nculo tiene con el menor?',           hint: 'Ej: padre, madre, tutor legal' },
      { key: 'tipo_procedimiento',label: 'Â¿QuÃ© procedimiento se autoriza?',           hint: 'Ej: tatuaje en el antebrazo, perforaciÃ³n de oreja, piercing nasal' },
      { key: 'establecimiento',  label: 'Nombre del establecimiento',                  hint: 'Estudio de tatuajes o local de piercing' },
      { key: 'fecha_turno',      label: 'Fecha del turno o procedimiento',            hint: 'DD/MM/AAAA' },
    ],
    promptSistema: `Eres un asistente legal argentino. RedactÃ¡s autorizaciones parentales para que menores de edad realicen tatuajes o piercings, segÃºn las normativas provinciales argentinas de habilitaciÃ³n de estudios.
GenerÃ¡ la autorizaciÃ³n completa con: identificaciÃ³n del menor y del tutor, vÃ­nculo, procedimiento especÃ­fico autorizado, establecimiento, fecha, declaraciÃ³n jurada del tutor de ser responsable legal, y conocimiento de los cuidados post-procedimiento.
IncluÃ­ espacio para firma del tutor con aclaraciÃ³n y nÃºmero de DNI visible.
Al final: "DOCUMENTO GENERADO POR IA â€” BORRADOR ORIENTATIVO. Algunos establecimientos pueden requerir presencia del tutor o certificaciÃ³n notarial. VerificÃ¡ los requisitos del local."`,
  },

  {
    id: 'ausencia_justificada',
    nombre: 'Nota de Ausencia',
    icono: 'ğŸ“‹',
    descripcion: 'JustificaciÃ³n de inasistencia escolar',
    preguntas: [
      { key: 'alumno_nombre',    label: 'Nombre completo del alumno/a',                hint: null },
      { key: 'grado_curso',      label: 'Â¿En quÃ© grado o curso estÃ¡?',                hint: 'Ej: 3Â° B primaria, 1Â° aÃ±o secundario' },
      { key: 'institucion',      label: 'Nombre de la instituciÃ³n educativa',          hint: null },
      { key: 'docente',          label: 'Â¿A quiÃ©n va dirigida la nota?',              hint: 'Ej: "SeÃ±ora directora", "Profesor/a de historia"' },
      { key: 'fechas_ausencia',  label: 'Â¿QuÃ© dÃ­as faltÃ³?',                           hint: 'Ej: lunes 14 y martes 15 de abril de 2025' },
      { key: 'motivo',           label: 'Â¿CuÃ¡l fue el motivo de la ausencia?',        hint: 'Ej: enfermedad, turno mÃ©dico, viaje familiar, trÃ¡mite' },
      { key: 'tutor_nombre',     label: 'Tu nombre (padre/madre/tutor)',               hint: null },
      { key: 'tutor_vinculo',    label: 'Â¿QuÃ© vÃ­nculo tenÃ©s con el alumno/a?',        hint: 'Ej: madre, padre, tutor legal' },
    ],
    promptSistema: `Eres un asistente educativo argentino. RedactÃ¡s notas de ausencia justificada en tono cordial y respetuoso.
GenerÃ¡ la nota completa con: lugar y fecha, destinatario, cuerpo explicando el motivo de la ausencia de forma clara sin exceso de detalles Ã­ntimos, solicitud de justificaciÃ³n de la inasistencia, ofrecimiento a presentar certificado mÃ©dico o documentaciÃ³n si fuera necesario, y cierre con firma del tutor.
Tono: formal pero cÃ¡lido, no burocrÃ¡tico.
Al final: "DOCUMENTO GENERADO POR IA â€” BORRADOR ORIENTATIVO."`,
  },

  {
    id: 'recibo_alquiler',
    nombre: 'Recibo de Alquiler',
    icono: 'ğŸ§¾',
    descripcion: 'Comprobante de pago de alquiler',
    preguntas: [
      { key: 'propietario_nombre',label: 'Nombre del propietario o administrador',    hint: 'Quien cobra el alquiler' },
      { key: 'propietario_dni',  label: 'DNI o CUIT del propietario',                hint: null },
      { key: 'inquilino_nombre', label: 'Nombre del inquilino',                       hint: 'Quien paga' },
      { key: 'inquilino_dni',    label: 'DNI del inquilino',                          hint: null },
      { key: 'inmueble',         label: 'DirecciÃ³n del inmueble alquilado',           hint: null },
      { key: 'periodo',          label: 'Â¿Por quÃ© perÃ­odo es el pago?',              hint: 'Ej: mes de mayo 2025' },
      { key: 'monto',            label: 'Â¿CuÃ¡nto se pagÃ³?',                          hint: 'Monto exacto en pesos o dÃ³lares' },
      { key: 'forma_pago',       label: 'Â¿CÃ³mo se realizÃ³ el pago?',                 hint: 'Ej: efectivo, transferencia bancaria, cheque' },
      { key: 'fecha_pago',       label: 'Fecha en que se realizÃ³ el pago',           hint: 'DD/MM/AAAA' },
    ],
    promptSistema: `Eres un asistente legal argentino. RedactÃ¡s recibos de alquiler simples y vÃ¡lidos.
GenerÃ¡ el recibo completo con: nÃºmero de recibo, lugar y fecha, identificaciÃ³n del propietario y el inquilino, direcciÃ³n del inmueble, perÃ­odo abonado, monto en letras y nÃºmeros, forma de pago, y declaraciÃ³n de que el pago fue recibido en conformidad.
DiseÃ±o limpio con todos los datos claramente separados. Espacio para firma del propietario o administrador.
Al final: "DOCUMENTO GENERADO POR IA â€” BORRADOR ORIENTATIVO."`,
  },
];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ESTADO GLOBAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const state = {
  currentDoc: null,
  answers: {},
  currentStep: 0,
  generatedDoc: '',
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VISTAS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showView(id) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  // Header solo en home
  document.getElementById('mainHeader').style.display = id === 'viewHome' ? 'flex' : 'none';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showToast(msg, duration = 3000) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), duration);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HOME â€” RENDERIZAR GRID
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderGrid() {
  const grid = document.getElementById('docGrid');
  grid.innerHTML = DOCUMENTS.map(doc => `
    <div class="doc-card" data-id="${doc.id}" role="button" tabindex="0" aria-label="${doc.nombre}">
      <div class="doc-icon">${doc.icono}</div>
      <div class="doc-info">
        <div class="doc-name">${doc.nombre}</div>
        <div class="doc-desc">${doc.descripcion}</div>
      </div>
    </div>
  `).join('');

  grid.querySelectorAll('.doc-card').forEach(card => {
    const open = () => startDocument(card.dataset.id);
    card.addEventListener('click', open);
    card.addEventListener('keydown', e => { if (e.key === 'Enter' || e.key === ' ') open(); });
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INICIAR DOCUMENTO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function startDocument(id) {
  const doc = DOCUMENTS.find(d => d.id === id);
  if (!doc) return;

  state.currentDoc = doc;
  state.answers = {};
  state.currentStep = 0;

  document.getElementById('chatDocName').textContent = doc.nombre;
  showView('viewChat');
  renderChatStep();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CHAT â€” RENDERIZAR PASO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderChatStep() {
  const doc = state.currentDoc;
  const total = doc.preguntas.length;
  const step = state.currentStep;
  const pregunta = doc.preguntas[step];

  // Header progress
  document.getElementById('chatStepLabel').textContent = `Pregunta ${step + 1} de ${total}`;
  document.getElementById('progressFill').style.width = `${((step) / total) * 100}%`;

  // Body
  const body = document.getElementById('chatBody');

  // Answered items
  const answered = doc.preguntas.slice(0, step).map(p => `
    <div class="answered-item">
      <span class="answered-key">${p.label}:</span>
      <span class="answered-val">${state.answers[p.key] || 'â€”'}</span>
      <span class="answered-check">âœ“</span>
    </div>
  `).join('');

  body.innerHTML = `
    <div class="question-block">
      <div class="question-chip">
        <span>âœ¦</span> Pregunta ${step + 1}/${total}
      </div>
      <div class="question-text">${pregunta.label}</div>
      ${pregunta.hint ? `<div class="question-hint">${pregunta.hint}</div>` : ''}
    </div>

    ${step > 0 ? `
      <div class="answered-section">
        <div class="answered-label">Ya respondiste</div>
        <div class="answered-list">${answered}</div>
      </div>
    ` : ''}
  `;

  body.scrollTop = 0;

  // Input
  const input = document.getElementById('chatInput');
  input.value = '';
  input.style.height = 'auto';
  input.disabled = false;
  document.getElementById('sendBtn').disabled = false;
  setTimeout(() => input.focus(), 100);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CHAT â€” ENVIAR RESPUESTA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function sendAnswer() {
  const input = document.getElementById('chatInput');
  const val = input.value.trim();
  if (!val) return;

  const doc = state.currentDoc;
  const pregunta = doc.preguntas[state.currentStep];

  state.answers[pregunta.key] = val;
  state.currentStep++;

  if (state.currentStep >= doc.preguntas.length) {
    // Todas las preguntas respondidas â†’ generar documento
    generateDocument();
  } else {
    renderChatStep();
  }
}

document.getElementById('sendBtn').addEventListener('click', sendAnswer);
document.getElementById('chatInput').addEventListener('keydown', e => {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    sendAnswer();
  }
});

// Auto-resize textarea
document.getElementById('chatInput').addEventListener('input', function() {
  this.style.height = 'auto';
  this.style.height = Math.min(this.scrollHeight, 120) + 'px';
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GENERAR DOCUMENTO VÃA CLAUDE API
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function generateDocument() {
  const doc = state.currentDoc;

  // Mostrar overlay
  document.getElementById('generatingOverlay').classList.remove('hidden');
  document.getElementById('chatInput').disabled = true;
  document.getElementById('sendBtn').disabled = true;

  // Construir contexto con las respuestas
  const resumen = doc.preguntas.map(p =>
    `${p.label}: ${state.answers[p.key] || 'No especificado'}`
  ).join('\n');

  const userMessage = `GenerÃ¡ el documento completo con los siguientes datos:\n\n${resumen}\n\nGenerÃ¡ el documento listo para imprimir, sin explicaciones previas, solo el documento.`;

  try {
    const response = await fetch(GEMINI_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        system_instruction: { parts: [{ text: doc.promptSistema }] },
        contents: [{ role: 'user', parts: [{ text: userMessage }] }],
        generationConfig: { temperature: 0.3, maxOutputTokens: 4096 },
      }),
    });

    if (!response.ok) {
      const err = await response.json().catch(() => ({}));
      if (response.status === 400) throw new Error('API key invÃ¡lida. VerificÃ¡ tu clave en aistudio.google.com');
      throw new Error(err.error?.message || `Error ${response.status}`);
    }

    const data = await response.json();
    const text = data.candidates?.[0]?.content?.parts?.[0]?.text || '';

    if (!text) throw new Error('El documento llegÃ³ vacÃ­o. IntentÃ¡ de nuevo.');

    state.generatedDoc = text;
    showPreview();

  } catch (err) {
    console.error(err);
    showToast('âŒ ' + (err.message || 'Error al generar el documento'), 5000);
    // Volver al Ãºltimo paso
    state.currentStep = Math.max(0, state.currentStep - 1);
    renderChatStep();
  } finally {
    document.getElementById('generatingOverlay').classList.add('hidden');
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MOSTRAR PREVIEW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showPreview() {
  document.getElementById('previewTitle').textContent = state.currentDoc.nombre;
  document.getElementById('docPaper').textContent = state.generatedDoc;
  showView('viewPreview');
  document.getElementById('progressFill').style.width = '100%';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GENERAR PDF â€” DISEÃ‘O PROFESIONAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

// Colores (R,G,B)
const PDF_COLORS = {
  verde:      [45,  106, 79],
  verde_light:[82,  183, 136],
  verde_bg:   [216, 243, 220],
  gris_bg:    [244, 245, 240],
  gris_borde: [221, 224, 216],
  tinta:      [26,  29,  23],
  tinta_2:    [61,  66,  56],
  tinta_3:    [107, 112, 102],
  muted:      [155, 163, 154],
  warn_bg:    [255, 248, 230],
  warn_border:[240, 192, 64],
  warn_ink:   [122, 92,  0],
  blanco:     [255, 255, 255],
};

function drawHeader(doc, docName, pageW, pageH) {
  const C = PDF_COLORS;
  const headerH = 26;

  // Fondo verde header
  doc.setFillColor(...C.verde);
  doc.rect(0, 0, pageW, headerH, 'F');

  // Barra acento verde light arriba
  doc.setFillColor(...C.verde_light);
  doc.rect(0, 0, pageW, 1.2, 'F');

  // Logo mark
  doc.setFillColor(...C.verde_light);
  doc.roundedRect(8, 6, 10, 10, 1.5, 1.5, 'F');
  doc.setTextColor(...C.blanco);
  doc.setFont('helvetica', 'bold');
  doc.setFontSize(6);
  doc.text('F.ia', 13, 12.5, { align: 'center' });

  // Nombre app
  doc.setFont('helvetica', 'bold');
  doc.setFontSize(10);
  doc.setTextColor(...C.blanco);
  doc.text('Formulario.ia', 22, 11);

  doc.setFont('helvetica', 'normal');
  doc.setFontSize(6.5);
  doc.setTextColor(183, 222, 200);
  doc.text('Documentos legales con IA', 22, 16.5);

  // Nombre documento â€” derecha
  doc.setFont('helvetica', 'bold');
  doc.setFontSize(11);
  doc.setTextColor(...C.blanco);
  doc.text(docName.toUpperCase(), pageW - 10, 12, { align: 'right' });

  // Fecha â€” derecha debajo
  const fecha = new Date().toLocaleDateString('es-AR', { day:'2-digit', month:'2-digit', year:'numeric' });
  doc.setFont('helvetica', 'normal');
  doc.setFontSize(6.5);
  doc.setTextColor(183, 222, 200);
  doc.text(`Generado el ${fecha}`, pageW - 10, 18, { align: 'right' });
}

function drawFooter(doc, pageNum, totalPages, pageW, pageH) {
  const C = PDF_COLORS;
  const footerY = pageH - 10;

  doc.setDrawColor(...C.gris_borde);
  doc.setLineWidth(0.3);
  doc.line(10, footerY - 3, pageW - 10, footerY - 3);

  doc.setFont('helvetica', 'normal');
  doc.setFontSize(6);
  doc.setTextColor(...C.muted);
  doc.text(
    'âš   BORRADOR ORIENTATIVO â€” ConsultÃ¡ con un profesional antes de firmarlo.',
    10, footerY
  );
  doc.text(`PÃ¡g. ${pageNum} / ${totalPages}`, pageW - 10, footerY, { align: 'right' });
}

function drawDisclaimer(doc, x, y, w) {
  const C = PDF_COLORS;
  const h = 14;

  // Fondo amarillo
  doc.setFillColor(...C.warn_bg);
  doc.setDrawColor(...C.warn_border);
  doc.setLineWidth(0.5);
  doc.roundedRect(x, y, w, h, 2, 2, 'FD');

  doc.setFont('helvetica', 'bold');
  doc.setFontSize(7);
  doc.setTextColor(...C.warn_ink);
  doc.text('âš   DOCUMENTO GENERADO POR IA â€” BORRADOR ORIENTATIVO', x + w/2, y + 5, { align: 'center' });

  doc.setFont('helvetica', 'normal');
  doc.setFontSize(6.5);
  doc.text(
    'Este documento fue generado por Formulario.ia con fines orientativos. ConsultÃ¡ con un profesional antes de firmarlo.',
    x + w/2, y + 10, { align: 'center' }
  );

  return y + h + 6;
}

function addPageWithHeader(doc, docName, pageW, pageH) {
  doc.addPage();
  drawHeader(doc, docName, pageW, pageH);
}

document.getElementById('downloadBtn').addEventListener('click', () => {
  if (!window.jspdf) {
    showToast('Cargando librerÃ­a PDFâ€¦');
    return;
  }

  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF({ unit: 'mm', format: 'a4', putOnlyUsedFonts: true });

  const C       = PDF_COLORS;
  const pageW   = 210;
  const pageH   = 297;
  const mLeft   = 10;
  const mRight  = 10;
  const mTop    = 32;      // debajo del header
  const mBottom = 16;
  const contentW = pageW - mLeft - mRight;
  const maxY    = pageH - mBottom;

  const docName = state.currentDoc.nombre;
  let y = mTop;

  // Primera pÃ¡gina: header
  drawHeader(pdf, docName, pageW, pageH);

  // FunciÃ³n para chequear salto de pÃ¡gina
  function checkPage(needed = 8) {
    if (y + needed > maxY) {
      addPageWithHeader(pdf, docName, pageW, pageH);
      y = mTop;
    }
  }

  // â”€â”€ PARSEAR Y RENDERIZAR EL TEXTO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Detectamos secciones, clÃ¡usulas numeradas y pÃ¡rrafos normales
  const rawLines = state.generatedDoc.split('\n');

  for (let i = 0; i < rawLines.length; i++) {
    const line = rawLines[i].trim();
    if (!line) { y += 3; continue; }

    // Detectar tÃ­tulo de clÃ¡usula/secciÃ³n en mayÃºsculas o con nÃºmero
    const isClausula = /^(PRIMERA|SEGUNDA|TERCERA|CUARTA|QUINTA|SEXTA|SÃ‰PTIMA|OCTAVA|NOVENA|DÃ‰CIMA|\d+[\.\-Â°])/i.test(line) && line.length < 120;
    const isHeading  = line === line.toUpperCase() && line.length < 80 && line.length > 3 && !/^\d/.test(line);
    const isFirma    = /firma|propietario|inquilino|acreedor|deudor|parte|aclaraciÃ³n/i.test(line) && line.includes('_');

    if (isClausula) {
      checkPage(12);
      // NÃºmero/tÃ­tulo en verde
      pdf.setFont('helvetica', 'bold');
      pdf.setFontSize(9);
      pdf.setTextColor(...C.verde);
      const parts = pdf.splitTextToSize(line, contentW);
      parts.forEach(p => {
        checkPage(6);
        pdf.text(p, mLeft, y);
        y += 5.5;
      });
      y += 1;

    } else if (isHeading) {
      checkPage(14);
      // Separador visual antes de secciÃ³n
      if (y > mTop + 10) {
        pdf.setDrawColor(...C.gris_borde);
        pdf.setLineWidth(0.3);
        pdf.line(mLeft, y, pageW - mRight, y);
        y += 4;
      }
      pdf.setFont('helvetica', 'bold');
      pdf.setFontSize(8);
      pdf.setTextColor(...C.verde);
      // Letra espaciada
      pdf.text(line, mLeft, y);
      y += 6;

    } else {
      checkPage(6);
      pdf.setFont('helvetica', 'normal');
      pdf.setFontSize(9.5);
      pdf.setTextColor(...C.tinta_2);
      const wrapped = pdf.splitTextToSize(line, contentW);
      wrapped.forEach(wl => {
        checkPage(6);
        pdf.text(wl, mLeft, y);
        y += 5.5;
      });
      y += 1;
    }
  }

  // â”€â”€ DISCLAIMER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  y += 6;
  checkPage(22);
  y = drawDisclaimer(pdf, mLeft, y, contentW);

  // â”€â”€ SECCIÃ“N DE FIRMAS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  checkPage(30);
  y += 2;
  pdf.setFont('helvetica', 'bold');
  pdf.setFontSize(8);
  pdf.setTextColor(...C.verde);
  pdf.text('FIRMAS', mLeft, y);
  y += 2;
  pdf.setDrawColor(...C.verde_light);
  pdf.setLineWidth(0.5);
  pdf.line(mLeft, y, mLeft + 20, y);
  y += 8;

  // Dos columnas de firma
  const colW = contentW / 2 - 5;
  const lineLen = colW - 5;

  // LÃ­neas de firma
  pdf.setDrawColor(...C.tinta_3);
  pdf.setLineWidth(0.4);
  pdf.line(mLeft, y, mLeft + lineLen, y);
  pdf.line(mLeft + colW + 10, y, mLeft + colW + 10 + lineLen, y);

  y += 4;
  pdf.setFont('helvetica', 'normal');
  pdf.setFontSize(7.5);
  pdf.setTextColor(...C.tinta_3);
  pdf.text('Firma y aclaraciÃ³n â€” Parte 1', mLeft, y);
  pdf.text('Firma y aclaraciÃ³n â€” Parte 2', mLeft + colW + 10, y);

  y += 4;
  pdf.setFontSize(6.5);
  pdf.setTextColor(...C.muted);
  const hoy = new Date().toLocaleDateString('es-AR');
  pdf.text(`Lugar y fecha: _________________, ${hoy}`, mLeft, y);

  // â”€â”€ FOOTERS EN TODAS LAS PÃGINAS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const totalPages = pdf.getNumberOfPages();
  for (let p = 1; p <= totalPages; p++) {
    pdf.setPage(p);
    drawFooter(pdf, p, totalPages, pageW, pageH);
  }

  const filename = `${state.currentDoc.id}_${new Date().toISOString().slice(0,10)}.pdf`;
  pdf.save(filename);
  showToast('âœ“ PDF descargado correctamente');
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BOTONES DE NAVEGACIÃ“N
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.getElementById('chatBackBtn').addEventListener('click', () => {
  showView('viewHome');
});

document.getElementById('previewBackBtn').addEventListener('click', () => {
  // Volver al Ãºltimo paso del chat
  state.currentStep = state.currentDoc.preguntas.length - 1;
  renderChatStep();
  showView('viewChat');
});

document.getElementById('previewRestartBtn').addEventListener('click', () => {
  showView('viewHome');
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCROLL HEADER SHADOW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
window.addEventListener('scroll', () => {
  document.getElementById('mainHeader').classList.toggle('scrolled', window.scrollY > 10);
}, { passive: true });

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
renderGrid();
</script>
</body>
</html>
